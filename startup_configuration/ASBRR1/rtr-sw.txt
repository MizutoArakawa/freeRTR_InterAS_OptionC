hostname ASBRR1
buggy
!
logging buffered debug 10240
logging file debug /rtr/run/logs/freertr.log
logging rotate 655360000 /rtr/run/logs/freertr.old
logging syslog informational local7 172.20.20.1
!
crypto rsakey rsa import $v10$TUlJRW9RSUJBQUtDQVFCMm9KRFJGZGpJQXoyd2gxR3FlTGVJQ3lKc1ZDem5qanlOSndBa0NPVTc4NU1YejljcldTdnRMZFAwUTd5R1lmVFpWd2J6alVScHJsUFZ1eVg3NWxHMEUwN3BJNGRseVZDd3oyZm5VWmkxMks0bnZUMU0xbGMyUHFNY3dRbkFKTEdkWTRMTERTRVdCNXB4VktqN2JYekl3VnE1TUE4QlBFL3lnR0hJN1NPdGlrbXlsYkVKZ3cxZzBXMlMyRG4vUnFZSkVlTlFmM0tUMkJWa1AraldhYWEraXRHMksxUlREeFBWSUI2YnhhSkhlSE1vOHczZmh3c3N5RmltSW5TSmdGUUM2cFgydy9rNnhRMHNkZzM5OHFBTFR0WjhEU3hqejVidmw0NGNLbmtMem15cko4TDVGRks2ZVhnVEZvNitCRWtEU3ZBTjNRQlMyelRzRVZTYzlSTnBBZ01CQUFFQ2dnRUFjcEloUzg4TjBCOVJOVzE4TW1qazJUL252emlOSmhiNTVGb0dpTWNPbnhoZ3VGN0VNZG10MHlTdjBQcWEyaTlCaTZmQnp2aGhXckJEeCtrNGhsR3NGMytPZHgwWlovVkhPWDBYblJIeHE2L2FoQWNCYlhTV1JvMjRlOHowM2Q2U3JLK3ZZdTBMUjN1UWJtU1YwRCt1aFRZNXFTSUJXL0FrUnRJM254ZHBuZkRnYndvNVR6ckRCQkZ1bjg4SU5GQmExSDY4VVZnTmk5akx2RStDbnhVWElnQUNMeERqakpNTldUb2VUNzMrSGNYR00yeHMvODhsQkJvMm1TanN0Z3lKbmRJRkVyWDIrbEJlb1BPTE9WTnFtcDF6UGYzMEV3aWRMd0toUU00bWxmSVArTkJSRHIxMTRKemNnOGJ0L1NuOG0xbTZPMS84STVFWUlkWlR2dXNVQVFLQmdRQzV2b0cyUXNhajJ1akppY1hTd3plRDkxYncwR0xmWVJpKzBVZ2liQU0yTVFydE9Gd0VUem5CREZ6RXhJd0hTWnF6a1BaY3daRHdmZlR3ckVWQzltakRqT1czWDhOY3M4UEpMbmtDZzQ2cHUweWdBQXUvRmZESDlkSm0yRHpKMXhOS0ZJK0NJYUxKTHh6dENIV3E5eWRLUDVVdWZZZ2tNWGVCb09QNjZQSi9YUUtCZ1FDamZ5cFdDK1Yrd05mZW1EbFR6cm5wTzQ5a2xrcEVHc2RFWHBJTmFRS1FiVThWT1NOYzFwS3gzR2ZBMG5PSCs4ZVoxRnBEY2hveHBIbWJpYWZZN0d2eksxdjF2TkJ0T00ybmN1bjRacGdhbjdOM21sbkFFUTM3aUFIcXJtRy9YZ3dBUHp1THlCemdJdmhoZm5MZlhCOEd4R1Z0R0I3TGpNSHdMUGFFVTdrL2ZRS0JnRDZIMndVdjM4MmowY0NmaUNDWEplWmdhejF3K2dnM21Pd01hcHRqLzRUTDUrREttM2U3OERhRVllckFQRi9yc0pBSkdsZEp0dkN2aHJsTFZabmdlSTUwclpVWlFSekJUQVU3aHZPSXRJdUJpWjlIeEt5VXgxV1o5VFk0VCthbmFGQUZNZmJlT2Y0K3hSOHJQT25NZ01hbk55TEtrZjJWUmFVM00ranhhVW5sQW9HQUwydHluQUpYVGF3ZzhDNjJjZGhEazZIeXRQbmlFRjZ6N09DQSsrSzVHNnFZaFU5Tk1tQUpyQXlCQ3l2KzFqSHdjbTFrd0tzWGJjNkdkdFkyR0hSNTJzMTRubzFrNWtqVFhQMjNYcFJqQ1ZYSWQ2Z00zK2dTWmlITWJJU25WUm14NFdCMXBOVWxpdHlacmEwL0pBbFQ5bUtBQ0dRMmlsTUk3T0FkbjhPb3R3RUNnWUI5dnRHVDM3Q2NRTnhDVmhiNnFOdzRsL1BLUlpNcDlZY21KQ0JPTHFWQjNRQThHb0p2ZW9iNk9OUGpiNVpGV2JCOFl2cmxQVU01V0h3dUNxTVlBRUhQUE56aTFqK3l4MXRYS2tPSklUbjNNNFI5T2EyQlVnZFdRZjBkdkVVMlZjOXlRR0hSaEIvaG5LUHNBS1BCUVBSZkNjYmN6eHNBQ3FCZ09zVGVFVWxLdFE9PQ==
!
crypto dsakey dsa import $v10$TUlJQnVBSUJBQUtCZ0dhNmtTMWU2TldIVkNpdzJMOUtabTQ1MFJDZ2wrcW5ndE9BMFJzcHpLVm5ueFk4N0k5QktLWGFvY2ZDWUhlbzFnTlROaVoxMmlkcytXOVhQa0tEZ3dOY3pHZFl1aFRJaE1KNDlGNEc2Qm5mUTY2Ly8zelE4SEFqbGJGSlh2djB0Y1pBNDU1T0Frb0FwMVh6eitScStWNW5tNXkxd2cwTnFhYVIySkNZOGwzTkFoVUFnRWlGSERJWVU2VHJDTWlmdGZoOTNaTGlwSmNDZ1lCU2pGY1pHdUhKSHI0d2ptdERvYlA0VjNhMTlUVkZwTkxOOGNOaWpUdVZOT3JKdG5BRE5ZNE93NmZlSjJyenJISjFtMlFIZFM1RTdPTG1xNnF1SVovcGd4Um16ZzB2ZzFDNGVVbitrQUdsa2xiaWU0WCtsSG9pMGdZbGdzelBUZlFIRXl5RjQ4aGJlZDJlL1ZlUUkzU1ROZXVqRUhnN0I3QjIzdWFRODgvRkZBSi9JTU9DUHlncm1nWVZPTmNhQ2NBbkgvVmtlbVkvUDJ0OFBwVDZUSXd6QjRRTHlQL0ZaMUI4YkdWWmlKaDRHQXdFQXYvSWFkeVpNL3Y0Tis3Mjg2Sno4cEdxRmczVWNPVnN2RVN1N1E3UGdubHFJUVFhKzFIcXhUZW82Qit1N0UvZVlOSHh3RDZVdmIwbVJwQkpWSXNvLzV2NjF3T0xyM0NYZmxRNS9INlpPd0lWQU9TL01SaXJIbEVHZmhzcGM2dzhRaGJqTDRaMQ==
!
crypto ecdsakey ecdsa import $v10$TUhRQ0FRRUVJQUNMZkNxT2NodU1udm9sY08rZytzODA3SFY0N2VSSEU2c1BpbUkzK1ZQVm9BY0dCU3VCQkFBS29VUURRZ0FFV0hPVjBCaENNMlVCcGZzb1NsS21qUis1Rmc2blNzVHpIcHN2TDNPVFBwNGF5aVd5S2RlMVd2S0l2RDRtcFZjdEYrTDBOYzBuZWtLSzZxbnEreGViWUE9PQ==
!
aaa userlist usr
 username rare
 username rare password $v10$cmFyZQ==
 exit
!
scheduler errors
 time 600000
 delay 30000
 command clear errors freerror@nop.hu
 start
 exit
!
prefix-list A-ROUTE
 sequence 10 permit 122.200.200.100/32 ge 32 le 32
 sequence 20 permit 100.50.80.4/30 ge 30 le 30
 sequence 30 permit 122.200.200.1/32 ge 32 le 32
 sequence 40 permit 20.200.135.0/30 ge 30 le 30
 sequence 50 permit 20.200.135.4/30 ge 30 le 30
 exit
!
prefix-list ALL4
 sequence 10 permit 0.0.0.0/0 ge 0 le 0
 exit
!
prefix-list ALL6
 sequence 10 permit ::/0 ge 0 le 0
 exit
!
prefix-list B-ROUTE
 sequence 10 permit 122.200.200.200/32 ge 32 le 32
 sequence 20 permit 100.50.81.4/30 ge 30 le 30
 sequence 30 permit 122.200.200.2/32 ge 32 le 32
 sequence 40 permit 20.200.136.0/30 ge 30 le 30
 sequence 50 permit 20.200.136.4/30 ge 30 le 30
 exit
!
prefix-list Lo-ROUTE
 sequence 10 permit 100.100.100.100/32 ge 32 le 32
 exit
!
route-policy CON-TO-BGP
 sequence 10 if prefix-list Lo-ROUTE
 sequence 20   pass
 sequence 30 else
 sequence 40   drop
 sequence 50 enif
 exit
!
route-policy PE-UL-ROUTE
 sequence 10 if prefix-list A-ROUTE
 sequence 20   set locpref 1400
 sequence 30   pass
 sequence 40 elsif prefix-list B-ROUTE
 sequence 50   set locpref 1000
 sequence 60   pass
 sequence 70 else
 sequence 80   pass
 sequence 90 enif
 exit
!
bundle 1
 exit
!
bundle 10
 exit
!
bundle 17
 exit
!
bundle 50
 exit
!
bundle 51
 exit
!
vrf definition DEF_SEGROUT
 exit
!
vrf definition OOB
 exit
!
router ospf4 10
 vrf DEF_SEGROUT
 router-id 100.100.100.100
 traffeng-id 0.0.0.0
 segrout 500 base 12000
 area 0 enable
 area 0 spf-ecmp
 area 0 segrout
 ecmp
 exit
!
router ospf4 20
 vrf DEF_SEGROUT
 router-id 1.1.1.1
 traffeng-id 0.0.0.0
 segrout 500 base 10000
 area 0 enable
 area 0 segrout
 exit
!
interface loopback1
 vrf forwarding DEF_SEGROUT
 ipv4 address 100.100.100.100 255.255.255.255
 router ospf4 10 enable
 router ospf4 10 area 0
 router ospf4 10 passive
 router ospf4 10 segrout index 100
 router ospf4 10 segrout node
 no shutdown
 log-link-change
 exit
!
interface loopback2
 vrf forwarding DEF_SEGROUT
 ipv4 address 1.1.1.1 255.255.255.255
 router ospf4 20 enable
 router ospf4 20 area 0
 router ospf4 20 passive
 router ospf4 20 segrout index 20
 router ospf4 20 segrout node
 no shutdown
 log-link-change
 exit
!
interface bundle1
 description eASBRR1
 vrf forwarding DEF_SEGROUT
 ipv4 address 10.10.186.1 255.255.255.252
 mpls enable
 router ospf4 20 enable
 router ospf4 20 area 0
 router ospf4 20 cost 3000
 no shutdown
 log-link-change
 exit
!
interface bundle10
 description P1
 vrf forwarding DEF_SEGROUT
 ipv4 address 10.100.135.2 255.255.255.252
 mpls enable
 router ospf4 10 enable
 router ospf4 10 area 0
 router ospf4 10 cost 700
 no shutdown
 log-link-change
 exit
!
interface bundle17
 description P2
 vrf forwarding DEF_SEGROUT
 ipv4 address 10.100.136.2 255.255.255.252
 mpls enable
 router ospf4 10 enable
 router ospf4 10 area 0
 router ospf4 10 cost 700
 no shutdown
 log-link-change
 exit
!
interface bundle50
 description ASBRR2
 vrf forwarding DEF_SEGROUT
 ipv4 address 10.100.142.1 255.255.255.252
 mpls enable
 router ospf4 10 enable
 router ospf4 10 area 0
 router ospf4 10 cost 1300
 no shutdown
 log-link-change
 exit
!
interface bundle51
 description ASBRR2
 vrf forwarding DEF_SEGROUT
 ipv4 address 10.10.186.9 255.255.255.252
 mpls enable
 router ospf4 20 enable
 router ospf4 20 area 0
 router ospf4 20 cost 900
 no shutdown
 log-link-change
 exit
!
interface ethernet1
 description [B10]P1_eth3
 cdp enable
 bundle-group 10
 no shutdown
 log-link-change
 exit
!
interface ethernet2
 description [B17]P2_eth3
 cdp enable
 bundle-group 17
 no shutdown
 log-link-change
 exit
!
interface ethernet255
 description MGMT
 vrf forwarding OOB
 ipv4 address 172.20.20.6 255.255.255.0
 no shutdown
 no log-link-change
 exit
!
interface ethernet3
 description [B50]ASBRR2_eth3
 cdp enable
 bundle-group 50
 no shutdown
 log-link-change
 exit
!
interface ethernet4
 description [B51]ASBRR2_eth4
 cdp enable
 bundle-group 51
 no shutdown
 log-link-change
 exit
!
interface ethernet5
 description [B1]eASBRR1_eth5
 cdp enable
 bundle-group 1
 no shutdown
 log-link-change
 exit
!
router bgp4 65000
 vrf DEF_SEGROUT
 local-as 65000
 router-id 100.100.100.100
 address-family labeled vpnuni
 !
 template RRC-LU remote-as 65000
 template RRC-LU local-as 65000
 template RRC-LU address-family labeled vpnuni
 template RRC-LU distance 200
 template RRC-LU additional-path-rx labeled vpnuni
 template RRC-LU additional-path-tx labeled vpnuni
 template RRC-LU update-source loopback1
 template RRC-LU segrout
 template RRC-LU route-reflector-client
 template RRC-LU next-hop-self
 !
 template eBGP remote-as 17000
 template eBGP local-as 65000
 template eBGP address-family labeled vpnuni
 template eBGP distance 20
 template eBGP ttl-security 3
 template eBGP additional-path-rx labeled vpnuni
 template eBGP additional-path-tx labeled vpnuni
 template eBGP update-source loopback2
 template eBGP segrout
 template eBGP route-policy-in PE-UL-ROUTE
 !
 template eBGP-LU remote-as 17000
 template eBGP-LU local-as 65000
 template eBGP-LU address-family labeled vpnuni
 template eBGP-LU distance 20
 template eBGP-LU ttl-security 1
 template eBGP-LU additional-path-rx labeled vpnuni
 template eBGP-LU additional-path-tx labeled vpnuni
 template eBGP-LU update-source loopback1
 template eBGP-LU segrout
 template eBGP-LU next-hop-unchanged
 !
 template iBGP-LU remote-as 65000
 template iBGP-LU local-as 65000
 template iBGP-LU address-family labeled vpnuni
 template iBGP-LU distance 200
 template iBGP-LU additional-path-rx labeled vpnuni
 template iBGP-LU additional-path-tx labeled vpnuni
 template iBGP-LU update-source loopback1
 template iBGP-LU segrout
 template iBGP-LU next-hop-self
 !
 neighbor 5.5.5.5 template eBGP
 !
 neighbor 100.100.100.1 template RRC-LU
 !
 neighbor 100.100.100.2 template RRC-LU
 !
 neighbor 100.100.100.200 template iBGP-LU
 !
 neighbor 122.200.200.100 template eBGP-LU
 !
 !
 redistribute connected route-policy CON-TO-BGP
 exit
!
console0
 no exec authorization
 no login authentication
 exit
!
proxy-profile OOB
 vrf OOB
 exit
!
!
!
!
!
!
!
!
!
!
!
!
!
!
!
ipv4 route OOB 0.0.0.0 0.0.0.0 172.20.20.1
!
!
!
!
!
!
!
!
!
!
!
!
server telnet OOB
 security authentication usr
 security rsakey rsa
 security dsakey dsa
 security ecdsakey ecdsa
 second-port 22
 exec timeout 0
 no exec authorization
 login authentication usr
 vrf OOB
 exit
!
client proxy OOB
client capture-path /rtr/run/pcap/
client name-server 1.1.1.1
client time-server europe.pool.ntp.org
client time-zone CET
!
end
